@*_verna_0930*@
@model homepage.ViewModel.CMapItem
@using homepage.ViewModel
@using homepage.Models
@{
    Layout = null;
    if (Session[CDictionary.SK_MemberId] == null)
    {
        Session[CDictionary.SK_MemberId] = CDictionary.SK_anonymous;
    }

}
<!DOCTYPE html>

<html>
<head>
    @*google登入 09/30*@
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="640701122888-kqkl96t9a7tjtkug7f2ve6pdovm9mrjs.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    @*sweetAlert2 CDN*@
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    @*sweetAlert2 CSS*@
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    @*20200916_15*@
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FunDayTrip</title>
    <link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <!-- 測滑動菜單Bootstrap _verna_0930-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="../../css/BootSideMenu.css" rel="stylesheet">

    @*jquery__verna_0930*@
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    @*地圖*@
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    @*mapbox plugins directions _verna_0930*@
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css" />

    <!-- 測滑動菜單Bootstrap _verna_0930 -->
    <script src="../../js/BootSideMenu.js"></script> @*位置要放在地圖後*@

    @*mapbox plugins language*@
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-language/v0.10.1/mapbox-gl-language.js'></script>
    @*sweet alert cdn _verna_0930*@
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    @*CustomerCSS.css _verna_0930*@
    <link href="~/css/CustomerlizeCSSofLocationAndRoute.css" rel="stylesheet" />
    @*jquery.form.js _verna_0930*@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js" integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn" crossorigin="anonymous"></script>


    @*-------------聊天室CSS---------------*@
    <link rel="stylesheet" type="text/css" href="~/css/test.css" />

    @* ===== 相簿CSS by kevin 10/06 ===== *@
    <link href="~/css/Album.css" rel="stylesheet" />

    @*登入*@
    <link href="~/css/Login.css" rel="stylesheet" />
    @* ===== 左側內容CSS by kevin 10/11 ===== *@
    <link href="~/css/LeftSideMenu.css" rel="stylesheet" />

    @*contextmenu _verna_0930*@
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>*@
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.ui.position.js"></script>

    @*_verna_0930*@
    <style>

        .footer {
            position: fixed;
            z-index: 1;
            left: 37.5%;
            bottom: 0;
            height: 20%;
            width: 25%;
            background-color: rgba(192, 192, 192, 0.6);
            color: black;
            text-align: center;
            border-top-left-radius: 25px;
            border-top-right-radius: 25px;
        }

        /*通知按鈕*/
        .noteBtn {
            width: 32px;
            height: 32px;
            position: relative;
            display: inline-block;
            margin: 0px;
        }
        /*通知數量*/
        .noteNum {
            position: absolute;
            top: -10px;
            right: -10px;
            padding: 2px 2px;
            border-radius: 50%;
            background: red;
            color: white;
            font-size: xx-small;
        }

        .info_panel {
            overflow: auto;
            max-height: 120px;
        }
        .role_button {
            border: none;
            padding: 0;
            background: none;
            width: 200px;
            text-align:center;
        }
    </style>

</head>
<body>
    <script>
        //現在頁籤位置
        var TabNow = "探索";
    </script>

    @*地圖 /綁定右鍵清單_verna_0930*@
    @*<div id='map' class="context-menu-one btn btn-neutral"></div>*@
    <div id='map'></div>

    @*上列選項清單_verna_0930 *@
    @Html.Partial("_topMenuNavigation")


    <div style="position:absolute; top:65px; left:45%;">
        @*新增地點*@
        <button id="addNewLocationButton" type="button" class="btn btn-danger" style="display:none; width:125px;">放置新增圖釘</button>

        @*新增廣告地點*@
        <button id="addNewAdLocButton" type="button" class="btn btn-danger" style="display:none; width:125px;">放置廣告圖釘</button>

        @*新增路線*@
        <button id="addNewRouteButton" type="button" class="btn btn-danger" style="width: 125px; display:none;">放置新增路線</button>

    </div>



    <div id="infoi2" style="display:none">
        @*路線地點詳細資訊*@
        @Html.Partial("_DetailInfoView")

    </div>

    @*滑鼠右鍵清單*@

    @if (Session[CDictionary.SK_MemberId].ToString() != CDictionary.SK_anonymous)
    {
        @Html.Partial("_ContextMenuPartialView")

    };


    @*顯示相簿*@
    @Html.Partial("_ShowAlbumView")

    @*新增/編輯相簿*@
    <div class="addAlbum" id="addAlbum">
        <span class="albumsclose close" onclick="setDivDisplay('addAlbum', 'none')">&times;</span>
        <form form method="post" enctype="multipart/form-data" id="addAlbumForm">
            @Html.Partial("_CreateOrEditAlbumForm")
        </form>
    </div>


    @*---------------------------------聊天室生成 2020/09/24 by曾開誠---------------------------------*@
    @*_verna_0930*@
    @Html.Partial("_ChatBoxPartialView")
    @*---------------------------------聊天室生成---------------------------------*@

    @*10/09 郭松明廣告旋轉木馬=========================*@
    <script>

        var parameter = "";
        var movementClassName = "";

        function ZoomAD(locationId) {
            listLocRoute.style.display = "block";
            getLocAjax(locationId);
        }

        $(function () {
            window.onload = function () {
                $.ajax({
                    url: "@Url.Action("ShowAD", "Advertisement")",
                    dataType: "json",
                    type:"POST",
                    success: function (response) {
                        console.log(response);
                        console.log(response.length);
                        for (var i = 0; i < response.length; i += 1)
                        {
                            console.log(i);
                            parameter = response[i].fId_Location;

                            if (i == 0) {
                                movementClassName = "active";
                            }
                            else
                            {
                                movementClassName = "";
                            }

                            var DIV = $("<div>").attr({
                                'id': "DIV" + [i] + "",
                                //'value': response[i].fId_Location,
                                'class': "item " + movementClassName + "",
                                'onclick': "ZoomAD('" + parameter +"')"
                            }).css({height:'140px',width:'379px'})
                            var img = $("<img>").attr({
                                'id': "AD" + [i] + "",
                                'src': response[i].fPhoto_Ad,
                                'align' :'left'
                            }).css({ width: '230px', height: '140px',opacity:'0.9'})
                            var content = $("<span style='font-size:18px;'>" + response[i].fContent_Ad + "</span>")

                            $(DIV).append(img);
                            $(DIV).append(content);
                            $("#inner_content").append(DIV);
                        }
                    },
                    fail: function (response) {
                        alert("失敗")
                    }
                });
            }
        });
    </script>


    @*地圖事件===============================*@
    <script>
        //全域變數===============================
        //經緯度變數
        var _lng, _lat;
        var Addedmarker;
        var _LocationID;
        //要求顯示中文地圖===========================
        mapboxgl.accessToken = 'pk.eyJ1Ijoia2V2aW43MDM5MiIsImEiOiJja2VtbGJuYmUwM3ZpMnVwZWoxMW04dDRnIn0.2js7hrb5XFX4qiERw78YiA';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v10',
            center: [121.5168963000, 25.0475371000],
            zoom: 8
        });
        var language = new MapboxLanguage({ defaultLanguage: 'zh' });
        map.addControl(language);
        //地圖一載入==================================
        map.on('load', function () {
            map.on('click', 'places', function (e) {

                // Change the cursor style as a UI indicator.
                map.getCanvas().style.cursor = 'pointer';

                var coordinates = e.features[0].geometry.coordinates.slice();
                var LocationID = e.features[0].properties.description;

                //CATCH ID跟座標
                //document.getElementById("clickInfo").innerHTML = LocationID + "<br/>" + coordinates + "<br/>";
                _LocationID = LocationID;
                console.log(_LocationID);
                _fX_Coordinate = coordinates[0];
                _fY_Coordinate = coordinates[1];
                Coords_Location = [_fX_Coordinate, _fY_Coordinate];
                //console.log(Coords_Location);
                fly(Coords_Location);
                zoomToLocation(LocationID);
            });
        });

    </script>

    @*  左側內容 _verna_0930  ===========================*@
<div id="LeftSideMenu">
    
    <h7 class="title"><span>Fun Day Trip</span></h7>
    <div id="Result_List2" style="width: 100%;">
        @*地點路線資訊*@
        @Html.Partial("_firstLoadAllListPartialView")
    </div>

</div>
   

    <script>
        var LogIn;
        //文件載入鎖定部分按鈕事件/顯示_verna_0930
        $(document).ready(function () {
            //個人資料方塊
            $("#locationInfo").hide();

            deletefollower();
            deletefans();
            chatroompressEnter();

        })
        function chatroompressEnter() {
            $(document).on('keyup', '#StringTextBox', function (event) {
                if (event.keyCode === 13) {
                    //event.preventDefault;
                        $(".c").click();
                }
            });
        };
        //顯示關閉左邊表單
        function closethisdiv() {

             @if (Session[CDictionary.SK_MemberId].ToString() != CDictionary.SK_anonymous)
             {
                 CLoginViewModel memberLogin = (CLoginViewModel)Session[CDictionary.SK_MemberLogin];
                 @:console.log("@memberLogin.fNickName_Member" + "@memberLogin.fId_Member");

             };

        }

        function deletefollower() {
            $(document).on('click', '.deletefollower', function () {
                var obj = $(this).parents('.trtest');


                console.log(obj);
                /////sweetalert
                Swal.fire({
                    title: '確定要刪除嗎',
                    text: "我們將會刪除這筆資料",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '是的,刪除',
                    cancelButtonText:'取消'

                }).then((result) => {
                    if (result.isConfirmed) {
                        $(obj).remove();
                        $.ajax({
                            url: "/Home/deletefollower",
                            type: "POST",
                            dataType: "json",
                            data: {
                                role_id: $("#active_role").val(),
                                target_id: $(obj).find('.btntest').val()
                            }

                        });
                        Swal.fire(
                            '刪除成功!'
                        )


                    }
                })
                //////ajax

            });
        }


        function deletefans() {
            $(document).on('click', '.deletefans', function () {
                var obj = $(this).parents('.trtest2');

                console.log(obj);
                ////ajax
                Swal.fire({
                    title: '確定要刪除嗎?',
                    text: "我們將會刪除這筆資料",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '是的,刪除',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $(obj).remove();
                        $.ajax({
                            url: "/Home/deletefans",
                            type: "POST",
                            dataType: "json",
                            data: {
                                role_id: $("#active_role").val(),
                                target_id: $(obj).find('.btntest').val()
                            }

                        });
                        Swal.fire(
                            '刪除成功!'
                        )
                    }
                })
            });
        }


        function deletefans() {
            $(document).on('click', '.deletefans', function () {
                var obj = $(this).parents('.trtest2');

          //      console.log(obj);
                ////ajax
                Swal.fire({
                    title: '確定要刪除嗎?',
                    text: "我們將會刪除這筆資料",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '是的,刪除',
                    cancelButtonText: '取消'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $(obj).remove();
                        $.ajax({
                            url: "/Home/deletefans",
                            type: "POST",
                            dataType: "json",
                            data: {
                                role_id: $("#active_role").val(),
                                target_id: $(obj).find('.btntest').val()
                            }

                        });
                        Swal.fire(
                            '刪除成功!'
                        )
                    }
                })

            });
        }
    </script>



    @*地圖中放置內容/按鍵(上)=====================*@
    <div class="container">
        <div class="row">
            <div class="col-md-12">


                @*開啟個人資料對話方塊*@
                @*<button id="toggle2" type="button" class="showHideButton">User</button>*@
                @*輸入登入資訊 by 王詠平 0921*@
                <div class="showHide" id="showHide">
                    <div>
                        @*如果沒有登入*@
                        @if (Session[CDictionary.SK_MemberId].ToString() == CDictionary.SK_anonymous)
                        {

                            @Html.Partial("_IfNotLogInProfile")

                        }
                        @*如果已經登入，顯示登入資訊*@
                        @if (Session[CDictionary.SK_MemberId].ToString() != CDictionary.SK_anonymous)
                        {
                            @Html.Partial("_AfterLoginProfilePartialView")
                        }
                    </div>

                </div>
                @*聊天室方塊 by曾開誠 註解已改為動態生成 function creatchatroom <div id="CHAT"不可刪>*@
                <div id="CHAT"></div>


                @*-----------------------------------追蹤粉絲頁面 by曾開誠09/23-------------------------------*@
                <div id="follow_modal" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <div style="justify-content:center;">
                            <button class="btn btn-info" onclick="showfollower()" type="submit">追隨中</button>
                            <button class="btn btn-info" onclick="showfans()" type="submit">粉絲</button>
                            <div id="follower_list"></div>
                        </div>
                    </div>
                </div>
                @*-----------------------------------追蹤粉絲頁面 by曾開誠09/23-------------------------------*@
                <script>                   
                    $("body").on("click", function (e) {

                        if (e.target.className == "modal-content") {
                            console.log("u");
                            $(".modal").show();
                        } else if (e.target.className == "modal") {
                            console.log("u2");
                            $(".modal").hide();
                        }
                       
                    })
                 
                </script>
            </div>
        </div>
        @*跳出新增/編輯視窗*@
        <div id="myModal" class="modal">
            @*<div class="modal-dialog">*@
            <div class="modal-content ">
                <form method="post" enctype="multipart/form-data" id="UploadLocationForm" style="height:500px;width:918px">
                    @Html.Partial("_CreateOrEditForm")
                </form>
            </div>@*model-contain*@
            @*</div>*@
        </div>@*model*@

        @*跳出"路線"新增/編輯視窗 by kevin 10/05*@
        <div id="instructions2">
            <span class="routeclose close" onclick="closeInstructions2()">&times;</span>
            <form form method="post" enctype="multipart/form-data" id="UploadRouteForm">
                @Html.Partial("_CreateOrEditRouteForm")
            </form>
        </div>

    </div>
    @*<script>
            $(function () {
                window.onload = function () {
                    $.ajax({
                        url:"@Url.Action("ShowAD", "Advertisement")",
                        type:"POST",
                        success: function (response) {
                            alert(response);
                            //$("#pwChange").css("display", "none")
                        },
                        fail: function (response) {
                            alert("失敗")
                        }
                    });
                }
            });
        </script>*@
    <div id="foot-content" class="footer">
        <div id="current_position" value="" style="color:black;background-color:#1C558E;border-top-left-radius:20px;border-top-right-radius:20px;opacity:0.6">
            <b style="font-size:17px;color:#fdca40;">推薦地點</b>
        </div>
        <div id="myCarousel" class="carousel slide" data-ride="carousel">
            <div id="inner_content" class="carousel-inner" value="">

            </div>
            <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    @*</div>*@

    @* 設定地圖中內容的事件 ==================*@
    <script>

        //叉叉:關閉資料表單
        var span = document.getElementsByClassName("close")[0];
        //左側彈出視窗 X按鈕
        $(".close").on("click", function () {
            CreateEditmodal.style.display = "none";
            follow_modal.style.display = "none";
            infoi2.style.display = "none";
        });

        ///////////////////////////////////////
        //粉絲/追蹤彈跳視窗
        function followcon() {
            if ($("#active_role").val() == false) {
                //alert("請先登入");
                Swal.fire({
                    title: '請先登入',
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp'
                    }
                })
            }
            else {
                follow_modal.style.display = "block";
            }
        };
        //粉絲/追蹤頁面按下追隨中按鈕 by曾開誠
        function showfollower() {
            $.ajax({
                url: "/Home/showFollow",
                type: "POST",
                dataType: "json",
                data: { role_id: $("#active_role").val() },
                success: function (response) {
                    //         console.log(response);
                    $("#follower_list").html("");
                    for (let i = 0; i < response.length; i++) {

                        let CD = '<tr class="trtest">';
                        CD += '<td>' + response[i].follow_Self_Name + '</td>';
                        CD += '<td>';
                        CD += '<button class="btn btn-link btntest" onclick="creatchatroom(this)" name="';
                        //style="border-bottom:dashed;margin-bottom:5px;border-color:blue;"
                        CD += response[i].follow_Self_Name;
                        CD += '"';
                        CD += 'value="';
                        CD += response[i].follow_Self_ID;
                        CD += '">';
                        CD += '聊天</button>';
                        CD += '</td>';
                        CD += '<td>';
                        CD += '<button style="margin-top:2px" class="btn btn-danger deletefollower">刪除好友</button>';
                        CD += '</td>';
                        CD += '</tr>';
                        CD += '<div></div>'
                        $("#follower_list").prepend(CD);
                    }
                }
            });
        };
        //粉絲/追蹤頁面按下粉絲按鈕 by曾開誠
        function showfans() {
            $.ajax({
                url: "/Home/showFan",
                type: "POST",
                dataType: "json",
                data: { role_id: $("#active_role").val() },
                success: function (response) {
                    //     console.log(response);
                    $("#follower_list").html("");
                    for (let i = 0; i < response.length; i++) {
                        let CD = '<tr class="trtest2">';
                        CD += '<td>' + response[i].follow_Target_Name + '</td>';
                        CD += '<td>';
                        CD += '<button class="btn btn-link btntest" onclick="creatchatroom(this)" name="';
                        //style="border-bottom:dashed;margin-bottom:5px;border-color:blue;"
                        CD += response[i].follow_Target_Name;
                        CD += '"';
                        CD += 'value="';
                        CD += response[i].follow_Target_ID;
                        CD += '">';
                        CD += '聊天</button>';
                        CD += '</td>';
                        CD += '<td>';
                        CD += '<button style="margin-top:2px" class="btn btn-danger deletefans">刪除粉絲</button>';
                        CD += '</td>';
                        CD += '</tr>';

                        CD += '<div></div>'

                        $("#follower_list").prepend(CD);
                    }
                }
            });
        };

        ///////////////////////////////////////////////////



    </script>

    @* ===== 新增廣告 by kevin 10/08 ===== *@
    <script>
        function makeIdentity() {

            //TODO:新增廣告的地點
            //放置廣告圖釘

            document.getElementById("addNewAdLocButton").style.display = "block";

        }

        $("#addNewAdLocButton").click(function () {
            _marker = new mapboxgl.Marker();
            console.log(_lng + "newbutton" + _lat);
            map.on('click', positioningClickLocate);
            map.on('dblclick', alertIfCreateAdLoc);

        })

        function alertIfCreateAdLoc() {

            console.log(_lng + "alert" + _lat);



            Swal.fire({
                title: '要新增廣告於此地點嗎?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                  //填寫廣告欄位
                if (result.isConfirmed) {
                    console.log("yes");

                    $.ajax({
                        url: "../Advertisement/StashAdCoordinate",
                        type: "POST",
                        data: { lng: _lng, lat: _lat }
                    }).done(function (response) {
                        console.log(response);

                        window.location.href = "@Url.Action("newCommercialData", "Advertisement")";
                    }).fail(function (xhr) {
                        console.log(xhr.status + xhr.responseText);
                    });//end ajax





                }

            });
        }


    </script>

    <script>
        //追蹤中地點
        function showFrLoc() {
            $('#LeftSideMenu').BootSideMenu.open();
            $("#tab_loc").text("追蹤地點");
            $("#tab_rou").text("追蹤路線");
        }

        //按我的地點 顯示可新增按鈕
        function showMyLoc() {
            $('#LeftSideMenu').BootSideMenu.open();
        $("#tab_loc").text("我的地點");
            $("#tab_rou").text("我的路線");
                TabNow = "我的地點";
                $("#addNewLocationButton").show();
                console.log(TabNow + "1");
                $("#map").addClass("context-menu-one btn btn-neutral");

        };

        //取得新增/編輯資料 表單id
        var CreateEditmodal = document.getElementById("myModal");
        //關閉新增/編輯資料 表單
        var span = document.getElementsByClassName("close")[0];
        $("#closeAddLocationForm").on("click", function () {
            CreateEditmodal.style.display = "none";
            //console.log(_marker);
            if (_marker != undefined) {
                _marker.remove();
            };

            $("#addNewLocationButton").one("click", enableAddLocation);//click(enableAddLocation); //呼叫函式:新增地點一開始的畫面
        });


        //點選新增地點,才可添加marker
        var _marker;//地圖上marker變數
        $("#addNewLocationButton").one("click", enableAddLocation);//click(enableAddLocation); //呼叫函式:新增地點一開始的畫面

        //函式:新增地點一開始的畫面
        function enableAddLocation() {
            _marker = new mapboxgl.Marker()
            //地圖上點選地點,在此綁定map click 另一個handler
            map.on('click', positioningClickLocate);
            ////地圖上雙擊決定添加的地點
            map.on('dblclick', alertIfAddLocation);

        };

        //函式:alert尋問是否要新增此地點
        function alertIfAddLocation() {
            map.off('dblclick', alertIfAddLocation);
            map.off('click', positioningClickLocate);
            Swal.fire({
                title: '要新增此地點嗎?',
                //text: "You won't be able to revert this!",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                //if (result.isConfirmed && Session[SK_AunctionAuth] == 4) {
                //    window.alert("營利會員成功");
                //}

                 if (result.isConfirmed) {
                    console.log("yes");
                    CreateEditmodal.style.display = "block";
                    document.getElementById("UploadLocationForm").reset();
                    $("#save").hide();
                    $("#create").show();
                    $("#fx_Coordinate").val(_lng);
                    $("#fy_Coordinate").val(_lat);
                    $("#fId_Role").val(@Session[CDictionary.SK_ActiveRoleId]);
                    $("#CreateOrEdit").text("新增地點");
                    document.getElementById('info3').innerHTML = _lng + "," + _lat;
                    _LocationID = "noLocationID";
                    console.log("新增時的id" + _LocationID + _lat + _lng);
                 }
                else {
                    console.log("no");
                    _marker.remove();
                    $("#addNewLocationButton").one("click", enableAddLocation);
                 }
            })
        }

        //新增時,在地圖上要新增的點
        var Id_Coordinate = [];
        var Name_Coordinate = [];
        var X_Coordinate = [];
        var Y_Coordinate = [];
        var CoordinateCnt = 0;

        function positioningClickLocate(e) {
            var x = parseFloat(e.lngLat.lng);
            var y = parseFloat(e.lngLat.lat);
            _marker.setLngLat([x, y]).addTo(map);

            //判斷是否填入已知坐標
            $.ajax({
                url: "/Home/SearchXY",
                type: "POST",
                dataType: "json",
                data: { x: x, y: y }
            }).done(function (response) {

                console.log(response);
                if (response.fId_Coordinate == 0) {
                    Id_Coordinate.push("0");
                    Name_Coordinate.push("地點");
                    X_Coordinate.push(x);
                    Y_Coordinate.push(y);
                    _lng = x;
                    _lat = y;
                }
                else {
                    Id_Coordinate.push("" + response.fId_Coordinate);
                    Name_Coordinate.push(response.fName_Coordinate);
                    X_Coordinate.push(response.fX_Coordinate);
                    Y_Coordinate.push(response.fY_Coordinate);
                    _lng = response.fX_Coordinate;
                    _lat = response.fY_Coordinate;
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax
        };

        //按編輯按鈕帶出該筆info
        function CallBackThisLocationInfoWhenEditor() {
            document.getElementById("UploadLocationForm").reset();
            $("#create").hide();
            $("#save").show();
            CreateEditmodal.style.display = "block";
         //   console.log("編輯時的id" + _LocationID);///////////////////////////
            $("#CreateOrEdit").text("編輯地點");
            //顯示該地點詳細內容
            $.ajax({
                url: "/Home/CallBackThisLocationInfo",
                type: "POST",
                data: { locationID: _LocationID },
            }).done(function (response) {
                var deJsonResponce = JSON.parse(response);

                deJsonResponce.forEach((item, element) => {

                    $("#fId_Location").val(item.fId_Location);
                    $("#fx_Coordinate").val(item.fX_Coordinate);
                    $("#fy_Coordinate").val(item.fY_Coordinate);
                    $("#CoordinateName").val(item.fName_Coordinate);
                    //console.log(item.fName_Coordinate);
                    $("#LocationName").val(item.fName_Location);
                    //$("#fAdd_Location").val(item.fAdd_Location);
                    $("#fDescript_Location").val(item.fDescript_Location);
                    //console.log(item.fDescript_Location);
                    //$("#fTitle_Photo").val(item.fTitle_Photo);
                    //$("#fDescript_Photo").val(item.fDescript_Photo);
                    var existedphoto = document.getElementById("output");
                    $("#output").attr("src", item.fPath_Photo);//IMAGE

                //    console.log(item.fDelete_Location);
                    if (item.fDelete_Location == 1) {
                        $('#checkbox').prop("checked", true)
                    } else {
                        $('#checkbox').prop("checked", false)
                    }

                    $('#selector option').removeAttr('selected');
                    if (item.fId_ShareAuth == 3) {
                        $('#selector option[value=3]').attr('selected', 'selected');
                    } else if (item.fId_ShareAuth == 2) {
                        $('#selector option[value=2]').attr('selected', 'selected');
                    } else {
                        $('#selector option[value=1]').attr('selected', 'selected');
                    };


                });
            }).fail(function (xhr) {
             //   console.log(xhr.status + xhr.responseText);
            });//end ajax

        };

    </script>
    @*我的地點*@
    <script>
        //預覽照片
        var loadFile = function (event) {
            var output = document.getElementById('output');
            output.src = URL.createObjectURL(event.target.files[0]);
            output.onload = function () {
                URL.revokeObjectURL(output.src) // free memory
            }
        };
        //變更地點資料庫
        //新增資料至資料庫
        function UpLoadLoctionFormButton() {
            _marker.remove();
            infoi2.style.display = "none";
            console.log("現在的id是" + _LocationID);
            $("#UploadLocationForm").ajaxSubmit({
                type: "POST",
                url: "/Home/createAlocation",
                success: function (response) {
                    // console.log(response);

                    if (response == "photoIsnotUploaded") {//如果沒有照片
                        Swal.fire(
                            '什麼?!沒有照片?',
                            '來張照片吧',
                            'warning',
                        )
                        return;
                    }
                    Swal.fire({
                        //position: 'top-end',
                        icon: 'success',
                        title: 'Your work has been saved',
                        showConfirmButton: false,
                        timer: 1000
                    })

                    CreateEditmodal.style.display = "none";
                    _marker.remove();
                    reload();
                },
                fail: function (failresponse) {

                    //  console.log(failresponse);
                }

            });
        };

        ///更新資料至資料庫
        function EditLoctionFormButton() {
            infoi2.style.display = "none";
            console.log("現在的id是" + _LocationID);
            $("#UploadLocationForm").ajaxSubmit({
                type: "POST",
                url: "/Home/EditLocationInfo",
                //data: { EditLocationId: _LocationID },
                success: function (response) {
                    //console.log(response);


                    var obj = document.getElementsByName("checkbox");

                    if (response == "photoIsnotUploaded") {//如果沒有照片
                        Swal.fire(
                            '什麼?!沒有照片?',
                            '來張照片吧',
                            'warning',
                        )
                        return;
                    }

                    Swal.fire({
                        //position: 'top-end',
                        icon: 'success',
                        title: 'Your work has been saved',
                        showConfirmButton: false,
                        timer: 1000
                    })
                    CreateEditmodal.style.display = "none";
                    reload();
                },
                fail: function (failresponse) {

                    console.log(failresponse);
                }
            });
        };
    </script>


    @* ========= 新增我的路線 by kevin 10/06 ========= *@
    <script>
        //我的路線 顯示可新增按鈕
        function showMyRou(roleID) {
            $('#LeftSideMenu').BootSideMenu.open();
            document.getElementById("UploadRouteForm").reset();
            $("#columns").empty();
            $("#addNewRouteButton").show();
            $("#tab_loc").text("我的地點");
            $("#tab_rou").text("我的路線");
        }

        //追蹤路線
        function showFrRou() {
            $("#tab_loc").text("追蹤地點");
            $("#tab_rou").text("追蹤路線");
        }

        //設定div狀態
        function setDivDisplay(DivID, Type) {
            var x = document.getElementById(DivID);
            if (x.style.display != Type)
                x.style.display = Type
        }

        //關閉新增編輯路線
        function closeInstructions2() {
            setDivDisplay("instructions2", "none");
            isAddRoute = false;
            $("#addNewRouteButton").hide();
            _marker.remove();

            if (map.getLayer(temprouteId)) {
                map.removeLayer(temprouteId);
            }

            document.getElementById("UploadRouteForm").reset();
            $("#columns").empty();
        }

        //隱藏新增路線的按鈕
        function hideAddRouteButton() {
            setDivDisplay("addNewRouteButton", "none");

        }

        //是否刪除路線
        function IfDeleteRoute() {
            var ifIsChecked = $('#checkboxes').is(":checked");

            if (ifIsChecked == true) {
                $('#checkboxes').val(1);
            } else {
                $('#checkboxes').val(0);
            }
        }

        //預覽路線照片
        var RoateloadFile = function (event) {
            //console.log(event);
            //console.log(event.target.nextSibling.id);
            var output = document.getElementById(event.target.nextSibling.id);
            //console.log(output);
            output.src = URL.createObjectURL(event.target.files[0]);
            output.onload = function () {
                URL.revokeObjectURL(output.src) // free memory
            }
        }
        //註冊新增路線
        $("#addNewRouteButton").on("click", enableAddRoute);
        var isAddRoute = false;

        // 可新增路線
        function enableAddRoute() {
            isAddRoute = true;
            _marker = new mapboxgl.Marker();
            map.on("dblclick", alertIfAddRoute);
            CoordinateCnt = 0;
        }

        //函式:alert尋問是否要新增此路線
        var tripInstructions = [];

        function alertIfAddRoute(e) {
            if (isAddRoute == false)
                return;

            positioningClickLocate(e);
            Swal.fire({
                title: '要新增此地點至路線嗎?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.isConfirmed) {
                    console.log("yes");
                    setDivDisplay("instructions2", "block");
                    $("#CreateOrEditRoute").text("新增路線");
                    $("#save2").hide();
                    $("#create2").show();
                    $("#fId_Roles").val(@Session[CDictionary.SK_ActiveRoleId]);
                    tripInstructions = "";

                    for (var i = 0; i < CoordinateCnt + 1; i++) {
                        console.log(CoordinateCnt);
                        $("#fx_Coordinate" + i).val(X_Coordinate[i]);
                        $("#fy_Coordinate" + i).val(Y_Coordinate[i]);
                        $("#header" + i).text("地點"+(i+1));

                        if (Id_Coordinate != 0) {
                            $("#fId_Coordinate" + i).val(Id_Coordinate[i]);
                            $("#header" + i).text("地點" + (i + 1));
                            //$("#fName_Coordinate" + i).val(Name_Coordinate[i]);
                        }
                    }
                    CoordinateCnt++;

                } else {
                    console.log("no");
                    _marker.remove();
                    $("#addNewRouteButton").one("click", enableAddRoute);
                    return;
                }
            })

            var columns = document.getElementById('columns');

            tripInstructions =
                '<div class="portlet">' +
                '<div class="portlet-header" id="header' + CoordinateCnt + '" name="header">' + '</div>' +
                '<div class="portlet-content" id="content" name="content" >' + '<div>' +
                '<div style="display:none">坐標' +
                '<div>坐標id</div>' +
                '<input name="fId_Coordinate[]" id="fId_Coordinate' + CoordinateCnt + '" />' +
                '<div>x</div>' +
                '<input name="fX_Coordinate[]" id="fx_Coordinate' + CoordinateCnt + '" />' +
                '<div>y</div>' +
                '<input name="fY_Coordinate[]" id="fy_Coordinate' + CoordinateCnt + '" />' +
                '</div>' +
                '<div>' +
                '<div class="form-group">'+
                '<div>地點名稱</div>' +
                '<input name="fName_Location[]" id="fName_Location' + CoordinateCnt + '" class="form-control" placeholder="Your Location Name *" />' +
                '</div>' +
                '<div class="form-group">' +
                '<div>地點描述</div>' +
            '<textarea name="fDescript_Location[]" id="fDescript_Location' + CoordinateCnt + '" class="form-control" placeholder="Your Location Descript *" style="height:75px;" ></textarea>' +
                '</div>' +
                '</div>' +
                '<div>' +
                '<div class="form-group">' +
                '<div>上傳照片</div>' +
                '<input type="file" accept="image/*" onchange="RoateloadFile(event)" name="PostImages">' +
                '<img id="output' + CoordinateCnt + '" style="width:94%;height:200px" src="https://i.imgur.com/7HtrXL4.png" />' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';

            columns.innerHTML += tripInstructions;

            $(function () {
                $(".columns").sortable({
                    connectWith: ".columns",
                    handle: ".portlet-header",
                    cancel: ".portlet-toggle",
                    placeholder: "portlet-placeholder ui-corner-all"
                });
                $(".portlet")
                    .addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all")
                    .find(".portlet-header")
                    .addClass("ui-widget-header ui-corner-all")
                    .prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>")

                $(".portlet-toggle").on("click", function () {
                    var icon = $(this);
                    icon.toggleClass("ui-icon-minusthick ui-icon-plusthick");
                    icon.closest(".portlet").find(".portlet-content").toggle();
                });
            });
        } //end alertIfAddRoute()

        //新增路線資料至資料庫
        function UpLoadRouteFormButton() {

            $("#UploadRouteForm").ajaxSubmit({
                type: "POST",
                url: "/Home/createAroute",
                //data: { EditLocationId: _LocationID },
                success: function (response) {
                    //console.log(response);
                    if (response == "photoIsnotUploaded") {//如果沒有照片
                        Swal.fire(
                            '什麼?!沒有照片?',
                            '來張照片吧',
                            'warning',
                        )
                        return;
                    }
                    Swal.fire({
                        //position: 'top-end',
                        icon: 'success',
                        title: '新增成功',
                        showConfirmButton: false,
                        timer: 1000
                    })

                    isAddRoute = false;
                    $("#addNewRouteButton").hide();
                    setDivDisplay("instructions2", "none");
                    _marker.remove();

                    if (map.getLayer(temprouteId)) {
                        map.removeLayer(temprouteId);
                    }

                    reload();
                },
                fail: function (failresponse) {
                    console.log(failresponse);
                }
            });
        };//end UpLoadRouteFormButton()

        //組成API需要的URL
        var url = 'https://api.mapbox.com/directions/v5/mapbox/walking/';
        var pointAddtoList = '';
        var points = [];
        var PointArryList = [];
        var temprouteId;
        function CreateLine() {
            points = [];

            for (var i = 0; i < X_Coordinate.length; i++) {
                xypoints = X_Coordinate[i] + "," + Y_Coordinate[i];
                var strxypoints = xypoints + "";
                points.push(strxypoints);
            }
            //console.log(points);

            if (points.length < 2 || isAddRoute == false) {
                // 兩點才可成線 或 是否為新增模式
                Swal.fire(
                    '什麼?!只有一個地點?',
                    '多給幾個地點吧',
                    'warning',
                )
                return;
            }

            //生成 directions API 的 URL
            for (var i = 0; i < points.length; i++) {
                points[i] = points[i].replace(",", "%2C");
                if (i != points.length - 1) {
                    points[i] += '%3B';
                }
                pointAddtoList += points[i];
            }

            url += pointAddtoList
                + '?alternatives=true&geometries=geojson&steps=true&access_token='
                + mapboxgl.accessToken;
            //console.log("url = " + url);

            PointArryList = [];
            points = [];
            pointAddtoList = "";
            //url = 'https://api.mapbox.com/directions/v5/mapbox/walking/';
            getRoute();
        }//End：AddLine function

        //呼叫Directions API生成路線
        var routecoords;

        function getRoute() {

            var xhr = new XMLHttpRequest();

            xhr.onload = function () {
                routecoords = JSON.parse(this.responseText).routes[0].geometry.coordinates;
                //console.log('routecoords = ' + routecoords);
                //routecoords = 121.524345,25.087955,121.524101,25.087597,121.524918,25.086075,121.525124,25.085943,121.524323,25.082506,121.524391,25.082487,121.523933,25.080505,121.523972,25.080351,121.524101,25.080347,121.525116,25.076786,121.525146,25.076807,121.525696,25.075336,121.525719,25.074856,121.525444,25.074406,121.524185,25.073515,121.523415,25.070774,121.522087,25.070707,121.52211,25.070087
                //routecoords = 121.518227,25.048702,121.515846,25.049044,121.513603,25.049578,121.512238,25.050011,121.510712,25.050304,121.510643,25.049948,121.510666,25.049934,121.510406,25.049965,121.508415,25.043259,121.507851,25.043365,121.507729,25.0429,121.507568,25.04283,121.507553,25.042591,121.507568,25.04283,121.50721,25.043449,121.507683,25.045067,121.508202,25.044949

                $("#fPath_Route").val(routecoords);
                //console.log(routecoords);

                //生成的路線加入地圖
                temprouteId = routecoords + "";
                map.addLayer({
                    id: temprouteId,
                    type: "line",
                    source: {
                        type: "geojson",
                        data: {
                            type: "Feature",
                            properties: {},
                            geometry: {
                                type: "LineString",
                                coordinates: routecoords
                            }
                        }
                    },
                    layout: {
                        "line-join": "round",
                        "line-cap": "round"
                    },
                    paint: {
                        "line-color": "#dc143c",
                        "line-width": 2
                    }
                }); //End：map.addLayer
            }; //End：xhr.onload function
            xhr.open('GET', url);
            xhr.send();
        }//End：getRoute function
    </script>

    @* ========= 編輯我的路線 by kevin 10/06 ========= *@
    <script>
        function report() {
            Swal.fire({
                title: '確定要檢舉?',
                text: "檢舉不當內容!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '確定',
                cancelButtonText: '取消',
            }).then((result) => {
                if (result.isConfirmed) {

                    document.getElementById("report").innerHTML = "已檢舉";
                    Swal.fire(
                        '檢舉成功',
                        '你已檢舉不當內容',
                        '成功',
                    )
                    var report_data = {
                        reportid: 3,
                        location: _LocationID,
                        route: _routeID,
                    };
                    $.ajax({
                        url: "/Home/Report",
                        type: "POST",
                        data: report_data,
                    }).done(function () {
                        console.log(檢舉成功);
                    }).fail(function () {
                        console.log(檢舉失敗);
                    });//end ajax
                }
            })
        }

        //按編輯按鈕帶出該筆路線info by kevin 10/06 =======路線修改有問題，再更新==========//
        function CallBackThisRouteInfoWhenEditor() {
            document.getElementById("UploadRouteForm").reset();
            $("#create2").hide();
            $("#save2").show();
            setDivDisplay("instructions2", "block");
            //console.log("編輯時的id" + _routeID);
            $("#CreateOrEditRoute").text("編輯路線");

            //顯示路線資訊
            $.ajax({
                url: "/Home/GetRoute",
                type: "POST",
                dataType: "json",
                data: { RouteID: _routeID }
            }).done(function (response) {
                //console.log(response);
                Route = GetRoutePathArray(response.fPath_Route);
                NickName_Role = (response.fNickName_Role);
                Name_Route = response.fName_Route;
                Auth_ShareAuth = response.fAuth_ShareAuth;
                Descript_Route = response.fDescript_Route;
                Time_Route = response.fTime_Route;
                Id_Route = response.fId_Route;
                //console.log("Route = " + Route);
                //console.log("NickName_Role = " + NickName_Role);
                //console.log("Name_Route = " + Name_Route);
                //console.log("Auth_ShareAuth = " + Auth_ShareAuth);
                //console.log("Descript_Route = " + Descript_Route);
                //console.log("Time_Route = " + Time_Route);
                $("#fName_Route").val(Name_Route);
                $("#fAuth_ShareAuth").val(Auth_ShareAuth);
                $("#fPath_Route").val(Route);
                $("#fDescript_Route").val(Descript_Route);
                $("#fId_Route").val(Id_Route);

                if (response.fDelete_Route == 1) {
                    $('#checkboxR').prop("checked", true)
                } else {
                    $('#checkboxR').prop("checked", false)
                }


                $('#selectorR option').removeAttr('selected');
                if (response.fId_ShareAuth == 3) {
                    $('#selectorR option[value=3]').attr('selected', 'selected');
                } else if (response.fId_ShareAuth == 2) {
                    $('#selectorR option[value=2]').attr('selected', 'selected');
                } else {
                    $('#selectorR option[value=1]').attr('selected', 'selected');
                };
            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax

            //顯示路線中的地點資訊k
            var Name_Location = [];
            var Descript_Location = [];
            var Time_Location = [];
            var Add_Location = [];
            var Id_Coordinate = [];
            //var X_Coordinate = [];
            //var Y_Coordinate = [];
            var Id_Location = [];
            X_Coordinate = [];
            Y_Coordinate = [];
            $.ajax({
                url: "/Home/RouteGetPoint",
                type: "POST",
                dataType: "json",
                data: { RouteID: _routeID }
            }).done(function (response) {
                //console.log(response);
                tripInstructions = "";

                for (var i = 0; i < response.length; i++) {
                    Name_Location.push(response[i].fName_Location);
                    Descript_Location.push(response[i].fDescript_Location);
                    Time_Location.push(response[i].futime);
                    Add_Location.push(response[i].fAdd_Location);
                    Id_Coordinate.push(response[i].fId_Coordinate);
                    X_Coordinate.push(response[i].fX_Coordinate);
                    Y_Coordinate.push(response[i].fY_Coordinate);
                    Id_Location.push(response[i].fId_Location);
                    //console.log("Name_Location =" + Name_Location[i]);
                    //console.log("Descript_Location =" + Descript_Location[i]);
                    //console.log("Time_Location =" + Time_Location[i]);

                    var columns = document.getElementById('columns');

                    tripInstructions +=
                        '<div class="portlet">' +
                        '<div class="portlet-header" id="header' + i + '" name="header">' + '</div>' +
                        '<div class="portlet-content" id="content" name="content" >' + '<div>' +
                        '<div style="display:none">坐標' +
                        '<div>坐標id</div>' +
                        '<input name="fId_Coordinate[]" id="fId_Coordinate' + i + '" />' +
                        '<div>x</div>' +
                        '<input name="fX_Coordinate[]" id="fx_Coordinate' + i + '" />' +
                        '<div>y</div>' +
                        '<input name="fY_Coordinate[]" id="fy_Coordinate' + i + '" />' +
                        '</div>' +
                        '<div>' +
                        '<div class="form-group">' +
                        '<div>地點名稱</div>' +
                        '<input name="fName_Location[]" id="fName_Location' + i + '" class="form-control" placeholder="Your Location Name *" />' +
                        '</div>' +
                        '<div class="form-group">' +
                        '<div>地點描述</div>' +
                        '<textarea name="fDescript_Location[]" id="fDescript_Location' + i + '" class="form-control" placeholder="Your Location Descript *" style="height:75px;"></textarea>' +
                        '</div>' +
                        '</div>' +
                        '<div>' +
                        '<div class="form-group">' +
                        '<div>上傳照片</div>' +
                        '<input type="file" accept="image/*" onchange="RoateloadFile(event)" name="PostImages">' +
                        '<img id="output' + i + '" style="width:100%;height:200px" />' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>';

                    columns.innerHTML = tripInstructions;

                    $(function () {
                        $(".columns").sortable({
                            connectWith: ".columns",
                            handle: ".portlet-header",
                            cancel: ".portlet-toggle",
                            placeholder: "portlet-placeholder ui-corner-all"
                        });
                        $(".portlet")
                            .addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all")
                            .find(".portlet-header")
                            .addClass("ui-widget-header ui-corner-all")
                            .prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>")

                        $(".portlet-toggle").on("click", function () {
                            var icon = $(this);
                            icon.toggleClass("ui-icon-minusthick ui-icon-plusthick");
                            icon.closest(".portlet").find(".portlet-content").toggle();
                        });
                    });
                }//end for

                for (var i = 0; i < Id_Location.length; i++) {
                    $("#fId_Coordinate" + i).val(Id_Coordinate[i]);
                    $("#fx_Coordinate" + i).val(X_Coordinate[i]);
                    $("#fy_Coordinate" + i).val(Y_Coordinate[i]);
                    //$("#fName_Coordinate" + i).val(Name_Location[i]);
                    $("#fName_Location" + i).val(Name_Location[i]);
                    $("#fDescript_Location" + i).val(Descript_Location[i]);
                    $("#header" + i).text(Name_Location[i]);
                }//end for

                //顯示路線中的照片資訊
                for (var i = 0; i < Id_Location.length; i++) {
                    $.ajax({
                        url: "/Home/GetLocationPhoto",
                        type: "POST",
                        dataType: "json",
                        async: false,
                        data: { LocationID: Id_Location[i] }
                    }).done(function (response) {

                        if (response.length) {
                            //console.log(response);
                            $("#output" + i).attr("src", response[0].fPath_Photo);
                            $("#fTitle_Photo" + i).val(response[0].fTitle_Photo);
                            $("#fDescript_Photo" + i).val(response[0].fDescript_Photo);
                        }
                        else {
                            alert("沒照片");
                        }
                    }).fail(function (xhr) {
                        console.log(xhr.status + xhr.responseText);
                    });//end ajax
                }//end for

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax
        } // end CallBackThisRouteInfoWhenEditor()

        //更新路線資料至資料庫
        function EditRouteFormButton() {
            $("#UploadRouteForm").ajaxSubmit({
                type: "POST",
                url: "/Home/EditRouteInfo",
                //data: { EditLocationId: _LocationID },
                success: function (response) {
                    //console.log(response);
                    //var obj = document.getElementsByName("checkbox");

                    if (response == "photoIsnotUploaded") {//如果沒有照片
                        Swal.fire(
                            '什麼?!沒有照片?',
                            '來張照片吧',
                            'warning',
                        )
                        return;
                    }

                    Swal.fire({
                        //position: 'top-end',
                        icon: 'success',
                        title: 'Your work has been saved',
                        showConfirmButton: false,
                        timer: 1000
                    })
                    isAddRoute = false;
                    $("#addNewRouteButton").hide();
                    setDivDisplay("instructions2", "none");
                    reload();
                },
                fail: function (failresponse) {
                    console.log(failresponse);
                }
            });
        };
    </script>

    <script>

        //文件載入:處理個人資料方塊,地點路線分布
        $(document).ready(function (e) {
            //reloadRoute();
            reload();
            $("#toggle2").click(function () {
                $("#showHide").toggle();

            });
            $("#addNewLocationButton").hide();
            $("#addNewRouteButton").hide();
            $('#LeftSideMenu').BootSideMenu.close();

        });
        //左側滑動清單設定
        $('#LeftSideMenu').BootSideMenu({
            side: "left",
            pushBody: false,
            autoClose: false,
            closeOnClick: false
        });

        //飛躍至該地k
        function fly(Point) {
            map.flyTo({
                center: Point, // [X,Y] Array
                essential: true,
                zoom: 13
            });
        }

        //ajax重整重新載入所有地點路線

        //重整
        function reload() {
            //   console.log("reload");
            LocArray = []

            $.ajax({
                url: "/Home/getAllLocations",
                type: "POST",
                dataType: "json",
                //data: { }
            }).done(function (response) {
                //console.log(response);
                for (var i = 0; i < response.length; i++) {
                    Coords_Location = [response[i].fX_Coordinate, response[i].fY_Coordinate];
                    Id_Location = response[i].fId_Location;

                    locJson =
                    {
                        'type': 'Feature',
                        'properties': {
                            'description': Id_Location
                        },
                        'geometry': {
                            'type': 'Point',
                            'coordinates': Coords_Location
                        }
                    };
                    LocArray.push(locJson);
                }//end for

                if (map.getLayer("places")) {
                    map.removeLayer("places");
                }
                if (map.getLayer("routes")) {
                    map.removeLayer("routes");
                }
                if (map.getSource("places")) {
                    map.removeSource("places");
                }
                if (map.getSource("routes")) {
                    map.removeSource("routes");
                }

                reloadRoute();

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax
        }

        //"取得路線"的第一個坐標，fly()要用到k
        function GetRoutePathArray(RouteInnerHTMLPath) {
            var RoutePath = new Array();
            var tempPoint = new Array();
            var strRoutePath = (RouteInnerHTMLPath + "").split(',');
            for (var i = 0; i < strRoutePath.length; i += 2) {
                tempPoint[i / 2] = new Array();
                tempPoint[i / 2][1] = strRoutePath[i + 1];
                tempPoint[i / 2][0] = strRoutePath[i];
                RoutePath.push(tempPoint[i / 2]);
            }
            return RoutePath;
        }

        //重新放入路線
        //路線所有資訊組成json，放到陣列
        var RouArray;
        function reloadRoute() {
            //console.log("reloadRoute");
            RouArray = []
            $.ajax({
                url: "/Home/getAllRoutes",
                type: "POST",
                dataType: "json",
                //data: { }
            }).done(function (response) {
                //console.log(response);
                for (var i = 0; i < response.length; i++) {

                    Id_Route = response[i].fId_Route;
                    //console.log(Id_Route);
                    Path_Route = GetRoutePathArray(response[i].fPath_Route);

                    rouJson =
                    {
                        'type': 'Feature',
                        'properties': {
                            'description': Id_Route
                        },
                        'geometry': {
                            'type': 'LineString',
                            'coordinates': Path_Route
                        }
                    };
                    RouArray.push(rouJson);
                    //console.log(RouArray);

                }//end for
                //console.log(RouArray);
                reloadlocation();
            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax

        };


        //重新放入地點/路線
        function reloadlocation() {

            //console.log("reloadAll");
            map.loadImage(
                'https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png',
                // Add an image to use as a custom marker
                function (error, image) {



                    if (error) throw error;
                    //console.log(map.hasImage('custom-marker'));

                    if (!map.hasImage('custom-marker')) {
                        map.addImage('custom-marker', image);
                    };


                    map.addSource('places', {
                        'type': 'geojson',
                        'data': {
                            'type': 'FeatureCollection',
                            'features': LocArray
                        }
                    });

                    // Add a layer showing the places.
                    map.addLayer({
                        'id': 'places',
                        'type': 'symbol',
                        'source': 'places',
                        'layout': {
                            'icon-image': 'custom-marker',
                            'icon-allow-overlap': true
                        }
                    });

                });

            //路線加入地圖k====================
            map.addSource('routes', {
                'type': 'geojson',
                'data': {
                    'type': 'FeatureCollection',
                    'features': RouArray
                }
            });//End：map.addSource

            map.addLayer({
                'id': 'routes',
                'type': 'line',
                'source': 'routes',
                layout: {
                    "line-join": "round",
                    "line-cap": "round"
                },
                paint: {
                    "line-color": "#dc143c",
                    "line-width": 6
                }
            });//End：map.addLayer
        };



    </script>

    <script>
        //取得該路線/點資料
        //顯示地點資訊，點列表k
        var listLocRoute = document.getElementById("infoi2");
        function zoomToLocation(LocationID) {
            $('#LeftSideMenu').BootSideMenu.close();
            listLocRoute.style.display = "block";
            getLocAjax(LocationID);
        };

        //顯示路線&地點資訊，點列表k
        function zoomToRoute(RouteID) {
            $('#LeftSideMenu').BootSideMenu.close();
            listLocRoute.style.display = "block";
            getRouAjax(RouteID);
        }//end zoomToRoute

        //顯示地點資訊k => 點列表、點地圖


        function getLocAjax(LocationID) {
            $.ajax({
                url: "/Home/GetLocation",
                type: "POST",
                dataType: "json",
                data: { LocationID: LocationID }
            }).done(function (response) {
                //console.log(response[0].fId_Location);
                fId_Location = response[0].fId_Location;
                Coords_Location = [response[0].fX_Coordinate, response[0].fY_Coordinate];
                NickName_Role = (response[0].fNickName_Role);
                Name_Location = response[0].fName_Location;
                Auth_ShareAuth = response[0].fAuth_ShareAuth;
                Descript_Location = response[0].fDescript_Location;
                Time_Location = response[0].futime;
                
                //console.log("Coords_Location = " + Coords_Location);
                //console.log("NickName_Role = " + NickName_Role);
                //console.log("Name_Location = " + Name_Location);
                //console.log("Auth_ShareAuth = " + Auth_ShareAuth);
                //console.log("Descript_Location = " + Descript_Location);
                //console.log("Time_Location = " + Time_Location);
                fly(Coords_Location);
                $("#id_location").html(fId_Location);
                $("#name_role").html(NickName_Role);
                $("#name_lr").html(Name_Location);
                $("#auth_lr").html(Auth_ShareAuth);
                $("#descript_lr").html(Descript_Location);
                $("#time_lr").html(Time_Location);
                $("#loc").empty();

                //*****/////
                var Name_Location = "";
                var loc = [];

                var locs = document.getElementById('descript_lr');
                    loc += '<div>' + Name_Location +
                        '<div>' + Descript_Location +
                        '</div></div>';
                    locs.innerHTML = loc;
                //end for

                if(response[0].fId_Role != @Session[CDictionary.SK_ActiveRoleId]) {
                    locs.innerHTML +=
                        '<div id="repoort" class="reportbtn">' +
                        '<button id="report" class="btn btn_Rou" onclick="report()">檢舉</button>' +
                        '</div>';
                }

                _LocationID = LocationID;
                //console.log(_LocationID);
            }).fail(function (xhr) {
               // console.log(xhr.status + xhr.responseText);
            });//end ajax

            $.ajax({
                url: "/Home/followOrNot",
                type: "POST",
                data: {
                    LocationID: LocationID,
                    myID:$("#active_role").val()
                    },
                success: function (response) {
                    console.log(response);
                    $("#addfollowbtn").html(response);

                }

            });

            $.ajax({
                url: "/Home/GetLocationPhoto",
                type: "POST",
                dataType: "json",
                data: { LocationID: LocationID }
            }).done(function (response) {
                //console.log(response);
                $("#photo_lr").attr("src", "");
                if (response.length) {
                    Path_Photo = response[0].fPath_Photo
                    //console.log("Path_Photo = " + Path_Photo);
                    $("#photo_lr").attr("src", Path_Photo);
                }
                else {
                    alert("沒照片");
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax

            //////
            document.getElementById("Comment").innerHTML = '';
            $.ajax({
                url: "/Home/HistoryLocationComment",
                type: "POST",
                dataType: "json",
                data: { LocationID: LocationID },
                success: function (response) {
                    for (let i = 0; i < response.length; i++) {
                        let HCMT = '<div class="comment-box-wrapper">';
                        HCMT += '<div class="comment-box">';
                        HCMT += ' <img src="https://i.imgur.com/vyWwMlr.png" class="commenter-image" alt="commenter_image">';
                        HCMT += '<div class="comment-content">';
                        HCMT += ' <div class="commenter-head">';
                        HCMT += '  <span class="commenter-name"><a href="">';
                        HCMT += response[i].fComment_Name;
                        HCMT += '</a ></span > ';
                        HCMT += ' <span class="comment-date"><i class="far fa-clock"></i>';
                        HCMT += response[i].fTime_Comment;
                        HCMT+='</span > ';
                        HCMT += '    </div>';
                        HCMT += ' <div class="comment-body">';
                        HCMT += '<span class="comment">' + response[i].fComment_Comment + '</span>';
                        HCMT += '</div>';
                        HCMT += '  <div class="comment-footer">';
                        HCMT += '</div>';
                        HCMT += ' </div>';
                        HCMT += '</div>';
                        HCMT += '  </div>';
                        $("#Comment").append(HCMT);
                    }
                }
            });
            //////

            /////
        }

        //顯示路線&地點資訊k => 點列表
        var _routeID;
        function getRouAjax(RouteID) {
            //顯示路線資訊
            $.ajax({
                url: "/Home/GetRoute",
                type: "POST",
                dataType: "json",
                data: { RouteID: RouteID }
            }).done(function (response) {
                //console.log(response);
                Route = GetRoutePathArray(response.fPath_Route);
                Id_Route = response.fId_Route;
                NickName_Role = (response.fNickName_Role);
                Name_Route = response.fName_Route;
                Auth_ShareAuth = response.fAuth_ShareAuth;
                Descript_Route = response.fDescript_Route;
                Time_Route = response.putime;
                //console.log("Route = " + Route);
                //console.log("NickName_Role = " + NickName_Role);
                //console.log("Name_Route = " + Name_Route);
                //console.log("Auth_ShareAuth = " + Auth_ShareAuth);
                //console.log("Descript_Route = " + Descript_Route);
                //console.log("Time_Route = " + Time_Route);
                _routeID = RouteID;
                fly(Route[0]);
                $("#id_location").html(Id_Route);
                $("#name_role").html(NickName_Role);
                $("#name_lr").html(Name_Route);
                $("#auth_lr").html(Auth_ShareAuth);
                $("#descript_lr").html(Descript_Route);
                $("#time_lr").html(Time_Route);
            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax

            //顯示路線中的地點資訊k
            var tempIdLoc = [];
            $.ajax({
                url: "/Home/RouteGetPoint",
                type: "POST",
                dataType: "json",
                async:false,
                data: { RouteID: RouteID }
            }).done(function (response) {
                //console.log(response[1]);
                var Name_Location = "";
                var loc = [];
                for (var i = 0; i < response.length; i++) {
                    Id_Location = response[i].fId_Location;
                    Name_Location = response[i].fName_Location;
                    Descript_Location = response[i].fDescript_Location;
                    Time_Location = response[i].futime;
                    //console.log("Name_Location =" + Name_Location);
                    //console.log("Descript_Location =" + Descript_Location);
                    //console.log("Time_Location =" + Time_Location);
                    tempIdLoc.push(Id_Location);
                    var locs = document.getElementById('loc');
                    loc += '<div class="locd"><div class="locdn">' + Name_Location + '</div>'+
                           '<div class="locdd">' + Descript_Location +
                           '</div></div>';
                    locs.innerHTML = loc;
                };//end for

                if (response[0].fId_Role == @Session[CDictionary.SK_ActiveRoleId]) {
                    locs.innerHTML +=
                        '<div id="editRoute" class="editroubtn">' +
                        '<button id="EditExistedRoute" class="btn btn_Rou" onclick="CallBackThisRouteInfoWhenEditor()">編輯路線</button>' +
                        '</div>';
                }
                else if(response[0].fId_Role != @Session[CDictionary.SK_ActiveRoleId]) {
                    locs.innerHTML +=
                        '<div id="repoort" class="reportbtn">' +
                        '<button id="report" class="btn btn_Rou" onclick="report()">檢舉</button>' +
                        '</div>';
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax
            //////
            //////
            document.getElementById("Comment").innerHTML = '';
            $.ajax({
                url: "/Home/HistoryRouteComment",
                type: "POST",
                dataType: "json",
                data: { RouteID: RouteID },
                success: function (response) {
                    for (let i = 0; i < response.length; i++) {
                        let HCMT = '<div class="comment-box-wrapper">';
                        HCMT += '<div class="comment-box">';
                        HCMT += ' <img src="https://i.imgur.com/vyWwMlr.png" class="commenter-image" alt="commenter_image">';
                        HCMT += '<div class="comment-content">';
                        HCMT += ' <div class="commenter-head">';
                        HCMT += '  <span class="commenter-name"><a href="">';
                        HCMT += response[i].fComment_Name;
                        HCMT += '</a ></span > ';
                        HCMT += ' <span class="comment-date"><i class="far fa-clock"></i>';
                        HCMT += response[i].fTime_Comment;
                        HCMT += '</span > ';
                        HCMT += '    </div>';
                        HCMT += ' <div class="comment-body">';
                        HCMT += '<span class="comment">' + response[i].fComment_Comment + '</span>';
                        HCMT += '</div>';
                        HCMT += '  <div class="comment-footer">';
                        HCMT += '</div>';
                        HCMT += ' </div>';
                        HCMT += '</div>';
                        HCMT += '  </div>';
                        $("#Comment").append(HCMT);
                    }
                }
            });
            //////////

            //////
            document.getElementById("Comment").innerHTML = '';
            $.ajax({
                url: "/Home/HistoryRouteComment",
                type: "POST",
                dataType: "json",
                data: { RouteID: RouteID },
                success: function (response) {
                    for (let i = 0; i < response.length; i++) {
                        let HCMT = '<div class="comment-box-wrapper">';
                        HCMT += '<div class="comment-box">';
                        HCMT += ' <img src="https://i.imgur.com/vyWwMlr.png" class="commenter-image" alt="commenter_image">';
                        HCMT += '<div class="comment-content">';
                        HCMT += ' <div class="commenter-head">';
                        HCMT += '  <span class="commenter-name"><a href="">';
                        HCMT += response[i].fComment_Name
                        HCMT += '</a ></span > ';
                        HCMT += ' <span class="comment-date"><i class="far fa-clock"></i>';
                        HCMT += response[i].fTime_Comment;
                        HCMT += '</span > ';
                        HCMT += '    </div>';
                        HCMT += ' <div class="comment-body">';
                        HCMT += '<span class="comment">' + response[i].fComment_Comment + '</span>';
                        HCMT += '</div>';
                        HCMT += '  <div class="comment-footer">';
                        HCMT += '</div>';
                        HCMT += ' </div>';
                        HCMT += '</div>';
                        HCMT += '  </div>';
                        $("#Comment").append(HCMT);
                    }
                }
            });
            //////////
        }
    </script>

    <script>
         @* google登入 *@
         $('#googlelogin').on('click', onSignIn);
        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            console.log('Full Name: ' + profile.getName());
            console.log('Given Name: ' + profile.getGivenName());
            console.log('Family Name: ' + profile.getFamilyName());
            console.log("Image URL: " + profile.getImageUrl());
            console.log("Email: " + profile.getEmail());
            var login_data = {
                email: profile.getEmail(),
                nickname: profile.getName(),
                firstname: profile.getGivenName(),
                lastname: profile.getFamilyName(),
                photo: profile.getImageUrl()
            };
        $.ajax({
            url: '@Url.Action("googlelogin", "Home")',
            type: "POST",
            dataType: "json",
            data: login_data
        }).done(function (response) {
            Swal.fire({
                title: response.loginMessage,
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            }).then(() => { window.location.reload() });
            //alert(response.loginMessage);
            //window.location.reload()
        }).fail(function (xhr, ajaxOptions, thrownError) {
            $("body").append(xhr.status);
            $("body").append(xhr.responseText);
            alert(thrownError);
        });
        };
    @* 登入 *@
    $('#loginBtn').on('click', login);
    function login() {
            var login_data = {
                email: $("#account").val(),
                pwd: $("#password").val()
            };
        $.ajax({
            url: '@Url.Action("login", "Home")',
            type: "POST",
            dataType: "json",
            data: login_data
        }).done(function (response) {
            Swal.fire({
                title: response.loginMessage,
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            }).then(() => { window.location.reload() });
        }).fail(function (xhr, ajaxOptions, thrownError) {
            $("body").append(xhr.status);
            $("body").append(xhr.responseText);
            alert(thrownError);
        });
    };

    //登出
    $('#logoutBtn').on('click', logout);
        function logout() {
            var login_data = {
                email: $("#login_email").val(),
            };
        $.ajax({
            url: '@Url.Action("logout", "Home")',
            type: "POST",
            dataType: "text",
            data: login_data
        }).done(function (response) {
            //alert(response);
            //window.location.reload()
            Swal.fire({
                title: response,
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            }).then(() => { window.location.reload() });
        }).fail(function (xhr, ajaxOptions, thrownError) {
            $("body").append(xhr.status);
            $("body").append(xhr.responseText);
            alert(thrownError);
        })
        };

        //通知按鈕
        function showNotes() {
            var role_id = { role_id: $("#active_role").val(), read: true };
            $.ajax({
                url:'@Url.Action("get", "Note")',
                type: "get",
                dataType: "json",
                data: role_id
            }).done(function (response) {
                $("#info_panel").html('<ul style="margin-right:10%" id="note_list"></ul>');
                for (let i = 0; i < response.length; i++) {
                    let note_item = "<div style='border-bottom:1px dotted gray;margin-bottom:10px;'>";
                        note_item +=  "<li id='note_li" + i +"' style='list-style-type:none'>";
                    note_item += response[i].fMessage_Note + "</li>" ;
                    note_item += "<div style='font-size:10px;text-align:right'>" + response[i].fTimeReadable_Note + "</div>";
                    note_item += "</li>";
                    note_item += "</div>" ;
                    $("#note_list").append(note_item);
                    $("#noteNum").hide();
                   // console.log(response[i].fMessage_Note);
                };
            }).fail(function (xhr, ajaxOptions, thrownError) {
                $("body").append(xhr.status);
                $("body").append(xhr.responseText);
                alert(thrownError);
            })
        };

        //切換身分按鈕
        function showRoles() {
            var member_id = { member_id: $("#login_id").val() };
            $.ajax({
                url:'@Url.Action("get", "Role")',
                type: "GET",
                dataType: "json",
                data: member_id
            }).done(function (response) {
                $("#info_panel").html('<ul id="role_list" style="list-style-type:none"></ul>');
                for (let i = 0; i < response.length; i++) {
                    let role_item = "";
                    role_item += "<li>";
                    role_item += "<button value='" + response[i].fId_Role + "'";
                    role_item += "name = '" + response[i].fNickName_Role + "'";
                    role_item += "onclick='changeRole(this)' class='role_button'>";
                    role_item += response[i].fNickName_Role;
                    if (response[i].fId_Slave_Type_Role == "a")
                    {
                        role_item += "(管理員)";
                    };
                    if (response[i].fId_Slave_Type_Role == "b") {
                        role_item += "(營利會員)";
                    };
                    role_item += "</button></li>";
               //     console.log(response[i].fNickName_Role);
                    $("#role_list").append(role_item)

                };
            }).fail(function (xhr, ajaxOptions, thrownError) {
                $("body").append(xhr.status);
                $("body").append(xhr.responseText);
                alert(thrownError);
            })
        };
        //切換身分連結
        function changeRole(myobj) {

            $("#follower_list").html("");

            var role_id = { role_id: myobj.value };
            //alert("即將切換為: " + myobj.name);

            let timerInterval
            Swal.fire({
                title: '即將切換身分為:' + myobj.name,
                timer: 1100,
                timerProgressBar: true,
                willOpen: () => {
                    Swal.showLoading()
                    timerInterval = setInterval(() => {
                        const content = Swal.getContent()
                        if (content) {
                            const b = content.querySelector('b')
                            if (b) {
                                b.textContent = Swal.getTimerLeft()
                            }
                        }
                    }, 100)
                },
                onClose: () => {
                    clearInterval(timerInterval)
                }
            }).then((result) => {
                /* Read more about handling dismissals below */
                if (result.dismiss === Swal.DismissReason.timer) {
                    console.log('I was closed by the timer')
                }
            }).then(() => {

                $.ajax({
                    url: '@Url.Action("changeRole", "Home")',
                    type: "POST",
                    dataType: "json",
                    data: role_id
                }).done(function (response) {
                /*alert("已切換身分為: " + response.fNickName_Role)*/;
                    $('#active_role').attr('value', response.fId_Role);
                    $("#role_type").attr("value", "1");
                    document.getElementById("active_role_name").innerHTML = response.fNickName_Role;
                    if (response.fId_Slave_Type_Role == "a") {
                        Swal.fire({
                            title: '管理員 ' + response.fNickName_Role + ', 您好!',
                            showClass: {
                                popup: 'animate__animated animate__fadeInDown'
                            },
                            hideClass: {
                                popup: 'animate__animated animate__fadeOutUp'
                            }
                        });
                        document.getElementById("backstage").style.display = "block";
                        $("#role_type").attr("value", "3");
                    };
                    if (response.fId_Slave_Type_Role == "b") {
                        Swal.fire({
                            title: '營利會員 ' + response.fNickName_Role + ', 您好!',
                            showClass: {
                                popup: 'animate__animated animate__fadeInDown'
                            },
                            hideClass: {
                                popup: 'animate__animated animate__fadeOutUp'
                            }
                        });
                        document.getElementById("newAD").style.display = "block";
                        $("#role_type").attr("value", "2");
                    };
                }).fail(function (xhr, ajaxOptions, thrownError) {
                    console.log(role_id);
                    $("body").append(xhr.status);
                    $("body").append(xhr.responseText);
                    alert(thrownError);
                })
            })};
        //讀取點數細節
        function showPoint() {
            $.ajax({
                url: '@Url.Action("get", "Point")',
                type: "GET",
                dataType: "json",
                data: { role_id: $("#active_role").val() },
            }).done(function (response){
                $("#info_panel").html('<ul id="points_list"></ul>');
                for (let i = 0; i < response.length; i++) {
               //     console.log(response[i]);
                    let point_item = "<li>";
                    point_item += "[" + response[i].fPoint_Point + "] ";
                    point_item += "[" + response[i].fType_Point + "] ";
                    point_item += "[" + response[i].fTimeReadable_Point + "] ";
                    point_item += "</li>";
                    $("#points_list").append(point_item);
                };
            }).fail(function (xhr, ajaxOptions, thrownError) {
              //  console.log(role_id);
                $("body").append(xhr.status);
                $("body").append(xhr.responseText);
                alert(thrownError);
            })
        };
    </script>

    @* ========= 顯示我的相簿 by kevin 10/07 ========= *@
    <script>
        //顯示相簿列表
        function showMyAlbums(roleID) {
            $("#albumList").empty();

            setDivDisplay("albums", "block");

            $.ajax({
                url: "/Home/showMyAlbums",
                type: "POST",
                data: { roleID: roleID },
            }).done(function (response) {
                //console.log(response);

                var album = document.getElementById('albumList');
                if (response.length == 0) {
                    albumInstructions =
                        '<div class="album"><div class="btnAddAlbum">' +
                        '<button type="button" class="btn btnaddA" onclick="addAlbum('+@Session[CDictionary.SK_ActiveRoleId]+')">新增相簿</button>' +
                        '</div></div>';
                    album.innerHTML += albumInstructions;
                }
                else {
                    for (var i = 0; i < response.length; i++) {
                        albumInstructions =
                            '<div class="album" >' +
                            '<div onclick="showAlbumDetail(' + response[i].fId_Album + ')">' +
                            '<div class="albumUserName" id="fNickName_Role' + i + '"><h5>' + response[i].fNickName_Role + '</h5></div>' +
                            '<div class="showAlbumPhoto" id="showAlbumPhoto">' +
                            '<img class="albumPhoto" src="' + response[i].fPath_Photo + '"/>' +
                            '</div>' +
                            '<div class="albumName" id="fName_Album' + i + '"><h3>' + response[i].fName_Album + '</h3></div>' +
                            '<div class="albumDescript" id="fDescript_Album' + i + '" ><h4>' + response[i].fDescript_Album + '</h4></div>' +
                            '</div>' +
                            '<div>' +
                            '<button type="button" class="btn btn-info editalbumbtn" onclick="editAlbum(' + @Session[CDictionary.SK_ActiveRoleId] +',' + response[i].fId_Album+')">修改相簿</button>' +
                            '</div>' +
                            '</div>';
                        album.innerHTML += albumInstructions;
                    }
                    album.innerHTML +=
                        '<div class="album"><div class="btnAddAlbum">' +
                        '<button type="button" class="btn btnaddA" onclick="addAlbum(' + @Session[CDictionary.SK_ActiveRoleId] +')">新增相簿</button>' +
                        '</div></div>';
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax
        } //end showMyAlbums()

        //顯示相簿內的地點列表
        function showAlbumDetail(fId_Album) {
            setDivDisplay("albumDetail", "block");
            setDivDisplay("albumList", "none");

            $.ajax({
                url: "/Home/showAlbumDetail",
                type: "POST",
                data: { albumId: fId_Album },
            }).done(function (response) {
                //console.log(response);
                var showBackToAlbumListButton = document.getElementById("showBackToAlbumListButton");
                showBackToAlbumListButton.innerHTML = "";
                showbtn = '<button type="button" class="btn btn-info" onclick="backToAlbumList()">返回相簿列表</button>';
                showBackToAlbumListButton.innerHTML = showbtn;

                var info = document.getElementById("Info_alist");
                info.innerHTML = "";

                for (var i = 0; i < response.length; i++) {

                    infoinstructions =
                        '<div class="info_a">' +
                        '<div id="name_role' + i + '" class="name_role">' + response[i].fNickName_Role + '</div>' +
                        '<div id="auth_lr' + i + '" class="auth_lr">' + response[i].fAuth_ShareAuth + '</div>' +
                        '<img id="photo_lr' + i + '" class="photo_lr" src="' + response[i].fPath_Photo + '" />' +
                        '<div id="name_lr' + i + '" class="name_lr">' + response[i].fName_Location + '</div>' +
                        '<div id="descript_lr' + i + '" class="descript_lr">' + response[i].fDescript_Location + '</div>' +
                        '</div>';
                    info.innerHTML += infoinstructions;
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText)
            });//end ajax
        }//end showAlbumDetail()

        //返回相簿列表
        function backToAlbumList() {
            setDivDisplay("albumList", "block");
            setDivDisplay("albumDetail", "none");

        }
    </script>

    @* ========= 新增我的相簿 by kevin 10/06 ========= *@
    <script>
        var loccnt = 0;
        var locid = "";
        function addAlbum(roleID) {
            document.getElementById("addAlbumForm").reset();
            setDivDisplay("addAlbum", "block");
            $("#createa").show();
            $("#savea").hide();
            $("#createOrEditA").text("新增相簿");

            //動態生成地點選項
            $.ajax({
                url: "/Home/showLocOptions",
                type: "POST",
                data: { roleID: roleID },
            }).done(function (response) {
                //console.log(response);
                var opt = document.getElementById("aloc");
                opt.innerHTML = "";
                var lloccnt = response.length;
                loccnt = lloccnt;
                for (var i = 0; i < response.length; i++) {
                    var optid = "aloc" + i;
                    locid = response[i].fId_Location + "";
                    var cnt = i + 1;
                    //optinfo = '<input type="checkbox" name="fId_Location[]" id="' + optid + '" onclick="IfSelectedLocations(' + "\'" + locid + "\'" + "," + "\'" + optid + "\'" + ')">' + response[i].fName_Location + '</br>';
                    optinfo = '<input type="checkbox" name="fId_Location[]" id="' + locid + '" onclick="IfSelectedLocations(' + "\'" + locid + "\'" + "," + "\'" + optid + "\'" + ')">' + cnt + "：" + response[i].fName_Location + '</br>';

                    opt.innerHTML += optinfo;
                }
            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText)
            });//end ajax
        }//end addAlbum()

        //是否刪除相簿
        function IfDeleteAlbum() {
            var ifIsChecked = $('#checkboxa').is(":checked");

            if (ifIsChecked == true) {
                $('#checkboxa').val(1);
            } else {
                $('#checkboxa').val(0);
            }
        }

        //相簿加入地點
        function IfSelectedLocations(idLocSelected, loci) {
            console.log("id = " + idLocSelected + ",loci = " + loci);
            var ifIsChecked = $('#' + idLocSelected).is(":checked");

            if (ifIsChecked == true) {
                $('#' + idLocSelected).val(idLocSelected);
            } else {
                return;
            }
        }

        //確定新增相簿-寫入資料庫
        function addAlbumFormButton() {

            $("#addAlbumForm").ajaxSubmit({
                type: "POST",
                url: "/Home/addAlbum",
                success: function (response) {
                    //console.log(response);
                    Swal.fire({
                        icon: 'success',
                        title: '新增相簿成功',
                        showConfirmButton: false,
                        timer: 1000
                    })
                    setDivDisplay("addAlbum", "none");
                    reloadAlbum();
                },
                fail: function (failresponse) {
                    console.log(failresponse);
                }
            });
        }
    </script>

    @* ========= 編輯我的相簿 by kevin 10/08 ========= *@
    <script>
        //按編輯帶入相簿資料
        var tempArrLoc = [];
        function editAlbum(roleID, albumID) {
            //console.log("roleID = " + roleID + "albumId = " + albumID);

            addAlbum(roleID);
            $("#savea").show();
            $("#createa").hide();
            $("#createOrEditA").text("修改相簿");

            $.ajax({
                url: "/Home/editMyAlbums",
                type: "POST",
                dataType: "json",
                data: { roleID: roleID, albumID: albumID }
            }).done(function (response) {
                console.log(response);

                $("#fDescript_Album").val(response.fDescript_Album);
                $("#fId_Album").val(albumID);
                $("#fName_Album").val(response.fName_Album);
                $("#fId_Role").val(roleID);

                if (response.fDelete_Album == 1) {
                    $('#checkboxa').prop("checked", true);
                    $('#checkboxa').val(1);
                } else {
                    $('#checkboxa').prop("checked", false);
                    $('#checkboxa').val(0);
                }

                $('#selectorA option').removeAttr('selected');
                if (response.fId_ShareAuth == 3) {
                    $('#selectorA option[value=3]').attr('selected', 'selected');
                } else if (response.fId_ShareAuth == 2) {
                    $('#selectorA option[value=2]').attr('selected', 'selected');
                } else {
                    $('#selectorA option[value=1]').attr('selected', 'selected');
                };

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText)
            });//end ajax

            //帶入有打勾的資料
            $.ajax({
                url: "/Home/editMyAlbumsLoc",
                type: "POST",
                dataType: "json",
                data: { roleID: roleID, albumID: albumID }
            }).done(function (response) {
                //console.log(response[0].fName_Location);
                //只撈有打勾的 fName_Location[]
                var Relocid = 0;
                var divLen = document.getElementById("aloc").childElementCount;
                var childID = 0;
                for (var i = 0; i < response.length; i++) {
                    Relocid = response[i].fId_Location;
                    console.log(Relocid);
                    for (j = 0; j < divLen; j++) {
                        childID = document.getElementById("aloc").children[j].id;
                        if (childID == Relocid) {
                            $('#' + Relocid).prop("checked", true);
                            $('#' + Relocid).val(Relocid);
                            break;
                        }
                    }
                }
            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText)
            });//end ajax
        }//end editAlbum()

        //更新相簿資料至資料庫
        function editAlbumFormButton() {
            console.log(document.getElementById("checkboxa").val);
            $("#addAlbumForm").ajaxSubmit({
                type: "POST",
                url: "/Home/EditAlbumInfo",
                //data: { EditLocationId: _LocationID },
                success: function (response) {
                    //console.log(response);

                    Swal.fire({
                        //position: 'top-end',
                        icon: 'success',
                        title: 'Your work has been saved',
                        showConfirmButton: false,
                        timer: 1000
                    })

                    setDivDisplay("addAlbum", "none");
                    reloadAlbum();
                },
                fail: function (failresponse) {
                    console.log(failresponse);
                }
            });
        };

        //重新載入相簿
        function reloadAlbum() {
            document.getElementById("addAlbumForm").reset();
            showMyAlbums(@Session[CDictionary.SK_ActiveRoleId]);
        }
    </script>

    @* ========= 顯示好友的相簿 by kevin 10/07 ========= *@
    <script>
        //顯示好友相簿列表
        function showMyFriendsAlbums(roleID) {
            $("#albumListfr").empty();

            setDivDisplay("albumsfr", "block");

            $.ajax({
                url: "/Home/showMyFriendsAlbums",
                type: "POST",
                data: { roleID: roleID },
            }).done(function (response) {
                //console.log(response);

                var album = document.getElementById('albumListfr');
                if (response.length == 0) {
                    albumInstructions =
                        '<div class="album">' +
                        '好友尚無分享相簿' +
                        '</div>';
                    album.innerHTML += albumInstructions;
                }
                else {
                    for (var i = 0; i < response.length; i++) {
                        albumInstructions =
                            '<div class="album" >' +
                            '<div onclick="showMyFriendsAlbumDetail(' + response[i].fId_Album + ')">' +
                            '<div class="albumUserName" id="fNickName_Role' + i + '"><h5>' + response[i].fNickName_Role + '</h5></div>' +
                            '<div class="showAlbumPhoto" id="showAlbumPhoto">' +
                            '<img class="albumPhoto" src="' + response[i].fPath_Photo + '"/>' +
                            '</div>' +
                            '<div class="albumName" id="fName_Album' + i + '"><h3>' + response[i].fName_Album + '</h3></div>' +
                            '<div class="albumDescript" id="fDescript_Album' + i + '" ><h4>' + response[i].fDescript_Album + '</h4></div>' +
                            '</div>' +
                            '</div>';
                        album.innerHTML += albumInstructions;
                    }
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText);
            });//end ajax
        } //end showMyAlbums()

        //顯示相簿內的地點列表
        function showMyFriendsAlbumDetail(fId_Album) {
            setDivDisplay("albumDetailfr", "block");
            setDivDisplay("albumListfr", "none");

            $.ajax({
                url: "/Home/showAlbumDetail",
                type: "POST",
                data: { albumId: fId_Album },
            }).done(function (response) {
                //console.log(response);

                var showBackToAlbumListButtonfr = document.getElementById("showBackToAlbumListButtonfr");
                showBackToAlbumListButtonfr.innerHTML = "";
                showbtnfr = '<button type="button" class="btn btn-info" onclick="backTofrAlbumList()">返回相簿列表</button>';
                showBackToAlbumListButtonfr.innerHTML = showbtnfr;

                var info = document.getElementById("Info_alistfr");
                info.innerHTML = "";

                for (var i = 0; i < response.length; i++) {

                    infoinstructions =
                        '<div class="info_a">' +
                        '<div id="name_role' + i + '" class="name_role">' + response[i].fNickName_Role + '</div>' +
                        '<div id="auth_lr' + i + '" class="auth_lr">' + response[i].fAuth_ShareAuth + '</div>' +
                        '<img id="photo_lr' + i + '" class="photo_lr" src="' + response[i].fPath_Photo + '" />' +
                        '<div id="name_lr' + i + '" class="name_lr">' + response[i].fName_Location + '</div>' +
                        '<div id="descript_lr' + i + '" class="descript_lr">' + response[i].fDescript_Location + '</div>' +
                        '</div>';
                    info.innerHTML += infoinstructions;
                }

            }).fail(function (xhr) {
                console.log(xhr.status + xhr.responseText)
            });//end ajax
        }//end showMyFriendsAlbumDetail()

        //返回相簿列表
        function backTofrAlbumList() {
            setDivDisplay("albumListfr", "block");
            setDivDisplay("albumDetailfr", "none");
        }
    </script>




    <script type="text/javascript">
        //jQuery處理button click event 當畫面DOM都載入時....
        $(function () {
            $("#btnSignIn").on("click", function () {
                GoogleLogin();//Google 登入
            });
            $("#logoutBtn").on("click", function () {
                Google_disconnect();//和Google App斷連
            });
        });

        function GoogleClientInit() {
            //官網範例寫client:auth2，但本人實測由於待會要呼叫gapi.client.init而不是gapi.auth2.init，所以給client即可
            gapi.load('client', function () {
                gapi.client.init({
                    //client_id 和 scope 兩者參數必填
                    clientId: CLIENT_ID,
                    //scope列表參考：https://developers.google.com/people/api/rest/v1/people/get
                    //"profile"是簡寫，要用完整scope名稱也可以
                    scope: "profile",//"https://www.googleapis.com/auth/userinfo.profile",
                    discoveryDocs: DISCOVERY_DOCS
                });
            });//end gapi.load
        }//end GoogleClientInit function

        function GoogleLogin() {
            let auth2 = gapi.auth2.getAuthInstance();//取得GoogleAuth物件
        }
        //end function GoogleLogin
        function Google_disconnect() {
            let auth2 = gapi.auth2.getAuthInstance(); //取得GoogleAuth物件
            auth2.disconnect().then(function () {
                console.log('User disconnect.');
            });
        }
    </script>
    <script type="text/javascript">
        let CLIENT_ID = "640701122888-kqkl96t9a7tjtkug7f2ve6pdovm9mrjs.apps.googleusercontent.com";
        //let API_KEY = '';//Javascript SDK無須 API 金鑰
        // Array of API discovery doc URLs for APIs
        let DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/people/v1/rest"];
    </script>
    @*執行Google API必須的.js，callback function名稱請自訂
        ↓https://apis.google.com/js/platform.js 或 https://apis.google.com/js/api.js 兩者網址都行得通 這裡採用跟官網寫法一樣*@
    <script async defer src="https://apis.google.com/js/api.js"
            onload="this.onload=function(){};GoogleClientInit()"
            onreadystatechange="if (this.readyState === 'complete') this.onload()">

    </script>
</body>
</html>