@model homepage.tMember

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script>

    $(function () {

        //說明:214行按變更密碼按鈕觸發顯示
        $("#pwButton").on("click", function () {
            $("#pwChange").css("display", "block")
        });

        //說明:226行確認變更密碼按鈕送出AJAX
        $("#confirmPw").on("click", changePW);
        function changePW() {
            var data = { id: $("#confirmPwId").val(), pw1: $("#pwInput1").val(), pw2: $("#pwInput2").val() };
            $.ajax({
                url: "/Home/changePW",
                type: "POST",
                dataType: "text",
                data: data,
                success: function (response) {
                    alert(response);
                }
            });
        }
    });

    //說明:預覽使用者照片功能
    var loadFile = function (event) {
        var output = document.getElementById('output');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function () {
            URL.revokeObjectURL(output.src) // free memory
        };
    };
</script>

<style>
    @@import url(https://fonts.googleapis.com/earlyaccess/cwtexyen.css);
</style>
<style>

    /*說明:回首頁超連結*/
    .TopDiv {
        text-align: right;
    }

    /*說明:主表單*/
    form {
        margin-left: 350px;
        justify-content: center;
    }

    /*說明:變更會員資料標題*/
    h2 {
        margin-left: 142px;
        margin-bottom: 30px;
        font-family: "cwTeXYen",sans-serif;
    }

    /*說明:使用者照片圓框*/
    .memberPhoto2 {
        margin-left: 150px;
        margin-top: 10px;
        display: flex;
        justify-content: center;
        width: 150px;
        height: 150px;
        border-radius: 999em;
    }

    /*說明:使用者照片圓框*/
    .IMG {
        height: 150px;
        width: 150px;
        border-radius: 999em;
    }

    /*說明:上傳檔案input*/
    .memberInput {
        margin-bottom: 10px;
        margin-left: 180px;
        width: 90px;
        display: flex;
        justify-content: center;
    }

    /*說明:上傳檔案input*/
    #memberPhotoFile2 {
        background-color: white;
        border-style: hidden;
    }

    /*說明:變更按鈕顯示密碼input*/
    #pwButton {
        border-style: none;
        color: blue;
        font-size: large;
        margin-left: 523px;
        background-color: white;
    }

    /*說明:密碼最外層div*/
    #pwChange {
        margin-top: 10px;
    }

    /*說明:各密碼欄位div*/
    .inierDiv {
        margin-left: 350px;
    }

    /*說明:新密碼input*/
    #pwInput1 {
        margin-left: 25px;
        display: inline-block;
    }

    /*說明:確認密碼input*/
    #pwInput2 {
        margin-left: 25px;
        display: inline-block;
    }

    /*說明:停用帳號按鈕*/
    .suspensionDiv {
        margin-left: 535px;
    }
</style>

@* E 回首頁連結*@
<div class="TopDiv">
    <label style="font-size:18px;">@Html.ActionLink("回首頁", "Index", "Home")</label>
</div>

@*說明:主表單，只包括基本資料修改*@
<form method="post" action="edit" enctype="multipart/form-data">
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h2>變更會員資料</h2>

        @*說明:輸出原先的使用者照片*@
        <div class="memberPhoto2">
            <img id="output" class="IMG" src="@Model.fPhoto_Member" />
        </div>

        @*說明:上傳新的照片*@
        <div class="memberInput">
            <input id="memberPhotoFile2" type="file" accept="image/*" onchange="loadFile(event)" class="form-control btn btn-info" name="image" value="上傳大頭貼">
        </div>

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        @*說明:隱藏傳入的fId*@
        <div class="form-group" style="display:none">
            @Html.LabelFor(model => model.fId_Member, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.fId_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fId_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:暱稱修改欄位*@
        <div class="form-group" style="margin-left:-60px;">
            <label class="control-label col-md-2">會員暱稱</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.fNickName_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fNickName_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:姓氏修改欄位*@
        <div class="form-group" style="margin-left:-60px;">
            <label class="control-label col-md-2">姓氏</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.fFirstName_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fFirstName_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:名字修改欄位*@
        <div class="form-group" style="margin-left:-60px;">
            <label class="control-label col-md-2">名字</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.fLastName_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fLastName_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:地址修改欄位*@
        <div class="form-group" style="margin-left:-60px;">
            <label class="control-label col-md-2">地址</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.fAdd_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fAdd_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:電話修改欄位*@
        <div class="form-group" style="margin-left:-60px;">
            <label class="control-label col-md-2">電話</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.fPhone_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fPhone_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:國家修改欄位*@
        <div class="form-group" style="margin-left:-60px;">
            <label class="control-label col-md-2">國家</label>
            <div class="col-md-10">
                @Html.EditorFor(model => model.fCountry_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fCountry_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:隱藏起來設置圖片路徑的修改欄位*@
        <div class="form-group" style="display:none;">
            @Html.LabelFor(model => model.fPhoto_Member, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.fPhoto_Member, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.fPhoto_Member, "", new { @class = "text-danger" })
            </div>
        </div>

        @*說明:送出修改按鈕傳送form*@
        <div class="form-group" style="margin-left:56px;">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="修改" class="btn btn-default" />
            </div>
        </div>
    </div>
</form>
@*說明:分隔線*@
<hr align="center" style="color:black; width:60%; border-style:solid;">

@*說明:顯示變更密碼區域*@
<button id="pwButton" class="btn btn-default">變更密碼</button>
<div id="pwChange" style="display:none;">
    <div class="inierDiv">
        <label style="display:inline-block;">輸入新密碼</label>
        <input id="pwInput1" type="password" name="fPassword_Member" class="form-control" />
    </div>
    <div class="inierDiv" style="margin-top:10px;">
        <label style="display:inline-block;">確認新密碼</label>
        <input id="pwInput2" type="password" name="confirmPW" class="form-control" />
    </div>
    <button id="confirmPw" class="btn btn-warning" style="margin-left:530px;margin-top:13px;">確定變更</button>
</div>

@*說明:用抓id的方式傳入AJAX再傳到控制器的變更密碼方法中*@
<input type="hidden" id="confirmPwId" value="@Model.fId_Member">

@*說明:分隔線*@
<hr align="center" style="color:black; width:60%; border-style:solid;">

@*說明:停用帳戶超連結*@
<div class="suspensionDiv">
    @Html.ActionLink("停用帳戶", "suspension", "Home",
        //說明:傳入參數
        new { id = Model.fId_Member },
        //說明: 彈出視窗，詢問是否真的停用，JS寫法
        new { onclick = "return confirm('確定停用帳戶嗎?')", style = "color:red;font-size: large;" })
</div>


